<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type" />
<!--
        XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
              This file is generated from xml source: DO NOT EDIT
        XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      -->
<title>Fichiers journaux - Serveur Apache HTTP Version 2.2</title>
<link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
<link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
<link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" /><link rel="stylesheet" type="text/css" href="./style/css/prettify.css" />
<script src="./style/scripts/prettify.min.js" type="text/javascript">
</script>

<link href="./images/favicon.ico" rel="shortcut icon" /><link href="http://httpd.apache.org/docs/current/logs.html" rel="canonical" /></head>
<body id="manual-page"><div id="page-header">
<p class="menu"><a href="./mod/">Modules</a> | <a href="./mod/directives.html">Directives</a> | <a href="http://wiki.apache.org/httpd/FAQ">FAQ</a> | <a href="./glossary.html">Glossaire</a> | <a href="./sitemap.html">Plan du site</a></p>
<p class="apache">Serveur Apache HTTP Version 2.2</p>
<img alt="" src="./images/feather.gif" /></div>
<div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
<div id="path">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">Serveur HTTP</a> &gt; <a href="http://httpd.apache.org/docs/">Documentation</a> &gt; <a href="./">Version 2.2</a></div><div id="page-content"><div class="retired"><h4>A savoir</h4>
            <p>Ce document concerne une version ancienne (<strong>2.2</strong>)
	    du serveur HTTP Apache. La version actuelle est
	    document&#233;e <a href="http://httpd.apache.org/docs/current">ici</a>. Si vous n'avez
	    pas encore effectu&#233; la mise &#232; jour, veuillez suivre <a href="http://httpd.apache.org/docs/current/upgrading.html">ce
	    lien</a> pour plus d'informations.</p>
        <p>Pour consulter la version actuelle de ce
	document, vous pouvez suivre <a href="http://httpd.apache.org/docs/current/logs.html">ce lien</a>.</p></div><div id="preamble"><h1>Fichiers journaux</h1>
<div class="toplang">
<p><span>Langues Disponibles: </span><a href="./en/logs.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
<a href="./fr/logs.html" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
<a href="./ja/logs.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
<a href="./ko/logs.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
<a href="./tr/logs.html" hreflang="tr" rel="alternate" title="T&#252;rk&#231;e">&nbsp;tr&nbsp;</a></p>
</div>

    <p>Pour v&#233;ritablement g&#233;rer un serveur web,
    il est n&#233;cessaire de disposer d'un
    retour d'informations &#224; propos de l'activit&#233; et des performances du
    serveur, ainsi que de tout probl&#232;me qui pourrait survenir. Le serveur HTTP
    Apache propose des fonctionnalit&#233;s de journalisation souples et tr&#232;s
    compl&#232;tes. Ce document d&#233;crit comment configurer ces fonctionnalit&#233;s de
    journalisation et interpr&#233;ter le contenu des journaux.</p>
  </div>
<div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#security">Avertissement &#224; propos de la s&#233;curit&#233;</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#errorlog">Journal des erreurs</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#accesslog">Journal des acc&#232;s</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#rotation">Rotation des journaux</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#piped">Journaux redirig&#233;s</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#virtualhost">H&#244;tes virtuels</a></li>
<li><img alt="" src="./images/down.gif" /> <a href="#other">Autres fichiers journaux</a></li>
</ul><ul class="seealso"><li><a href="#comments_section">Commentaires</a></li></ul></div>
<div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="security" id="security">Avertissement &#224; propos de la s&#233;curit&#233;</a></h2>
    

    <p>Tout utilisateur qui dispose de droits en &#233;criture sur le r&#233;pertoire dans
    lequel Apache &#233;crit ses journaux pourra quasi
    certainement avoir acc&#232;s &#224; l'uid sous lequel le serveur est d&#233;marr&#233;, en
    l'occurrence habituellement root. N'accordez <em>PAS</em> aux utilisateurs
    l'acc&#232;s en &#233;criture au r&#233;pertoire dans lequel les journaux sont stock&#233;s
    sans savoir exactement quelles en seraient les cons&#233;quences ; voir le
    document <a href="misc/security_tips.html">conseils sur la s&#233;curit&#233;</a>
    pour plus de d&#233;tails.</p>

    <p>En outre, les journaux peuvent contenir des informations fournies
    directement par un client, sans caract&#232;res d'&#233;chappement. Des clients mal
    intentionn&#233;s peuvent donc ins&#233;rer des caract&#232;res de contr&#244;le dans les
    journaux, et il convient par cons&#233;quent &#234;tre tr&#232;s prudent lors de la
    manipulation des journaux bruts.</p>
  </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="errorlog" id="errorlog">Journal des erreurs</a></h2>
    

    <table class="related"><tr><th>Modules Apparent&#233;s</th><th>Directives Apparent&#233;es</th></tr><tr><td /><td><ul><li><code class="directive"><a href="./mod/core.html#errorlog">ErrorLog</a></code></li><li><code class="directive"><a href="./mod/core.html#loglevel">LogLevel</a></code></li></ul></td></tr></table>

    <p>Le journal des erreurs du serveur, dont le nom et la localisation sont
    d&#233;finis par la directive <code class="directive"><a href="./mod/core.html#errorlog">ErrorLog</a></code>,
    est le journal le plus important. C'est dans celui-ci
    que le d&#233;mon Apache httpd va envoyer les informations de diagnostic et
    enregistrer toutes les erreurs qui surviennent lors du traitement des
    requ&#234;tes. Lorsqu'un probl&#232;me survient au d&#233;marrage du serveur ou pendant
    son fonctionnement, la premi&#232;re chose &#224; faire est de regarder dans ce
    journal, car il vous renseignera souvent sur le probl&#232;me rencontr&#233; et
    la mani&#232;re d'y rem&#233;dier.</p>

    <p>Le journal des erreurs est habituellement enregistr&#233; dans un fichier
    (en g&#233;n&#233;ral <code>error_log</code> sur les syst&#232;mes de type Unix et
    <code>error.log</code> sur Windows et OS/2). Sur les syst&#232;mes de type Unix,
    le serveur peut aussi enregistrer ses erreurs dans
    <code>syslog</code> ou les
    <a href="#piped">rediriger vers un programme</a> par l'interm&#233;diaire d'un
    tube de communication (pipe).</p>

    <p>Le format du journal des erreurs est descriptif et de forme
    relativement libre. Certaines informations apparaissent cependant dans la
    plupart des entr&#233;es du journal. Voici un message typique
    &#224; titre d'exemple : </p>

    <div class="example"><p><code>
      [Wed Oct 11 14:32:52 2000] [error] [client 127.0.0.1]
      client denied by server configuration:
      /export/home/live/ap/htdocs/test
    </code></p></div>

    <p>Le premier champ de l'entr&#233;e du journal est la date et l'heure du
    message. Le second champ indique la s&#233;v&#233;rit&#233; de l'erreur rapport&#233;e. La
    directive <code class="directive"><a href="./mod/core.html#loglevel">LogLevel</a></code> permet de
    restreindre le type des erreurs qui doivent &#234;tre enregistr&#233;es
    dans le journal des erreurs en d&#233;finissant leur niveau de s&#233;v&#233;rit&#233;. Le
    troisi&#232;me champ contient l'adresse IP du client qui a g&#233;n&#233;r&#233; l'erreur.
    Vient ensuite le message proprement dit, qui indique dans ce cas que le
    serveur a &#233;t&#233; configur&#233; pour interdire l'acc&#232;s au client. Le serveur
    indique le chemin syst&#232;me du document requis (et non
    son chemin web).</p>

    <p>Une grande vari&#233;t&#233; de messages diff&#233;rents peuvent appara&#238;tre dans le
    journal des erreurs. La plupart d'entre eux sont similaires &#224; l'exemple
    ci-dessus. Le journal des erreurs peut aussi contenir des informations de
    d&#233;bogage en provenance de scripts CGI. Toute information qu'un script CGI
    &#233;crit sur la sortie d'erreurs standard <code>stderr</code> sera recopi&#233;e
    telle quelle dans le journal des erreurs.</p>

    <p>Il n'est pas possible de personnaliser
    le journal des erreurs en ajoutant ou en
    supprimant des informations. Cependant, les entr&#233;es du journal des erreurs
    qui concernent certaines requ&#234;tes poss&#232;dent des entr&#233;es correspondantes
    dans le <a href="#accesslog">journal des acc&#232;s</a>. Ainsi, l'entr&#233;e de
    l'exemple ci-dessus correspond &#224; une entr&#233;e du journal des acc&#232;s avec un
    code de statut 403. Etant donn&#233; qu'il est possible de personnaliser le
    journal des acc&#232;s, vous pouvez obtenir d'avantage d'informations sur les
    circonstances d'une erreur en consultant ce journal.</p>

    <p>Pendant la phase de test, il est souvent utile de visualiser en continu
    le journal des erreurs afin de d&#233;tecter tout probl&#232;me &#233;ventuel. Sur les
    syst&#232;mes de type Unix, ceci s'effectue &#224; l'aide de la commande :</p>

    <div class="example"><p><code>
      tail -f error_log
    </code></p></div>
  </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="accesslog" id="accesslog">Journal des acc&#232;s</a></h2>
    

    <table class="related"><tr><th>Modules Apparent&#233;s</th><th>Directives Apparent&#233;es</th></tr><tr><td><ul><li><code class="module"><a href="./mod/mod_log_config.html">mod_log_config</a></code></li><li><code class="module"><a href="./mod/mod_setenvif.html">mod_setenvif</a></code></li></ul></td><td><ul><li><code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code></li><li><code class="directive"><a href="./mod/mod_log_config.html#logformat">LogFormat</a></code></li><li><code class="directive"><a href="./mod/mod_setenvif.html#setenvif">SetEnvIf</a></code></li></ul></td></tr></table>

    <p>Le journal des acc&#232;s au serveur
    enregistre toutes les requ&#234;tes que traite
    ce dernier. La localisation et le contenu du journal des acc&#232;s sont d&#233;finis
    par la directive <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code>.
    La directive <code class="directive"><a href="./mod/mod_log_config.html#logformat">LogFormat</a></code>
    permet de simplifier la s&#233;lection du contenu du journal. Cette section
    d&#233;crit comment configurer le serveur pour l'enregistrement des informations
    dans le journal des acc&#232;s.</p>

    <p>Bien &#233;videmment, le stockage d'informations dans le journal des acc&#232;s
    n'est que le point de d&#233;part de la gestion de la journalisation. L'&#233;tape
    suivante consiste &#224; analyser ces informations de fa&#231;on &#224; pouvoir en
    extraire des statistiques utiles. L'analyse de journaux en g&#233;n&#233;ral est hors du
    cadre de ce document et ne fait pas vraiment partie int&#233;grante
    du travail du serveur web lui-m&#234;me. Pour plus d'informations &#224; propos de ce
    sujet et des applications d&#233;di&#233;es &#224; l'analyse de journaux, vous pouvez vous
    r&#233;f&#233;rer &#224; <a href="http://dmoz.org/Computers/Software/Internet/     Site_Management/Log_analysis/">Open Directory</a> ou
    <a href="http://dir.yahoo.com/Computers_and_Internet/Software/     Internet/World_Wide_Web/Servers/Log_Analysis_Tools/">Yahoo</a>.</p>

    <p>Diff&#233;rentes versions du d&#233;mon Apache httpd utilisaient d'autres modules
    et directives pour contr&#244;ler la journalisation des acc&#232;s, &#224; l'instar de
    mod_log_referer, mod_log_agent, et de la directive
    <code>TransferLog</code>. La directive
    <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code> rassemble
    d&#233;sormais les fonctionnalit&#233;s de toutes les anciennes directives.</p>

    <p>Le format du journal des acc&#232;s est hautement configurable. Il est
    d&#233;fini &#224; l'aide d'une cha&#238;ne de format qui ressemble sensiblement &#224; la
    cha&#238;ne de format de style langage C de printf(1). Vous trouverez quelques
    exemples dans les sections suivantes. Pour une liste exhaustive de ce que
    peut contenir une cha&#238;ne de format, vous pouvez vous r&#233;f&#233;rer au chapitre
    <a href="mod/mod_log_config.html#formats">cha&#238;nes de format</a> de la
    documentation du module <code class="module"><a href="./mod/mod_log_config.html">mod_log_config</a></code>.</p>

    <h3><a name="common" id="common">Format habituel du journal</a></h3>
      

      <p>Voici une configuration typique pour le journal des acc&#232;s :</p>

      <div class="example"><p><code>
        LogFormat "%h %l %u %t \"%r\" %&gt;s %b" common<br />
         CustomLog logs/access_log common
      </code></p></div>

      <p>Ici est d&#233;finie l'<em>identit&#233;</em> <code>common</code> qui est
      ensuite associ&#233;e &#224; une cha&#238;ne de format de journalisation particuli&#232;re.
      La cha&#238;ne de format est constitu&#233;e de directives d&#233;butant par le
      caract&#232;re %, chacune d'entre elles indiquant au serveur d'enregistrer
      un &#233;l&#233;ment particulier d'information. Des caract&#232;res litt&#233;raux peuvent
      &#233;galement &#234;tre ins&#233;r&#233;s dans la cha&#238;ne de format ; il seront copi&#233;s tels
      quels dans le flux de sortie destin&#233; &#224; la journalisation.
      Les guillemets (<code>"</code>) doivent &#234;tre prot&#233;g&#233;es en les faisant
      pr&#233;c&#233;der d'un anti-slash (<code>\</code>) afin qu'ils ne soient pas
      interpr&#233;t&#233;s comme la fin de la cha&#238;ne de format. La cha&#238;ne de format
      peut aussi contenir les caract&#232;res de contr&#244;le sp&#233;ciaux
      "<code>\n</code>" et "<code>\t</code>" pour ins&#233;rer respectivement
      un passage &#224; la ligne et une tabulation.</p>

      <p>La directive <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code>
      d&#233;finit un nouveau fichier journal en l'associant &#224; l'identit&#233;
      pr&#233;c&#233;demment d&#233;finie. Le chemin du nom de fichier associ&#233; au journal
      des acc&#232;s est relatif au chemin d&#233;fini par la directive
      <code class="directive"><a href="./mod/core.html#serverroot">ServerRoot</a></code>, sauf s'il
      d&#233;bute par un slash.</p>

      <p>La configuration ci-dessus va enregistrer les entr&#233;es de
      journalisation selon un format connu sous le nom de
      Common Log Format (CLF) pour "Format de journalisation standard".
      Ce format standard peut &#234;tre produit par de nombreux serveurs web
      diff&#233;rents et lu par de nombreux programmes d'analyse de journaux.
      Les entr&#233;es de fichier journal g&#233;n&#233;r&#233;es selon le format CLF
      ressemblent &#224; ceci :</p>

      <div class="example"><p><code>
        127.0.0.1 - frank [10/Oct/2000:13:55:36 -0700] "GET
        /apache_pb.gif HTTP/1.0" 200 2326
      </code></p></div>

      <p>Chaque partie de cette entr&#233;e de journal est d&#233;crite
      dans ce qui suit.</p>

      <dl>
        <dt><code>127.0.0.1</code> (<code>%h</code>)</dt>

        <dd>Il s'agit de l'adresse IP du client (l'h&#244;te distant) qui a envoy&#233;
	la requ&#234;te au serveur. Si la directive
	<code class="directive"><a href="./mod/core.html#hostnamelookups">HostnameLookups</a></code> est positionn&#233;e &#224;
	<code>On</code>, le serveur va essayer de d&#233;terminer le nom de l'h&#244;te
	et de l'enregistrer &#224; la place de l'adresse IP. Cette configuration
	n'est cependant pas recommand&#233;e car elle peut ralentir le serveur de
	mani&#232;re significative. Il est par cons&#233;quent pr&#233;f&#233;rable d'utiliser un
	processeur d'analyse de journaux a posteriori
	tel que <code class="program"><a href="./programs/logresolve.html">logresolve</a></code>
	pour d&#233;terminer les noms d'h&#244;te. L'adresse IP indiqu&#233;e ici n'est pas
	n&#233;cessairement l'adresse IP de la machine devant laquelle se trouve
	l'utilisateur. Si un serveur mandataire s'intercale entre le serveur
	et l'utilisateur, l'adresse indiqu&#233;e sera celle du mandataire et non
	celle de la machine &#224; l'origine de la requ&#234;te.</dd>

        <dt><code>-</code> (<code>%l</code>)</dt>

        <dd>Le "trait d'union" indique que la portion d'information
	correspondante n'est pas disponible. Dans le cas pr&#233;sent, l'information
	non disponible est l'identit&#233; (RFC 1413) du client telle que d&#233;termin&#233;e
	par <code>identd</code> sur la machine cliente. Cette information est
	tr&#232;s peu fiable et ne devrait jamais &#234;tre utilis&#233;e, sauf dans le cas
	de r&#233;seaux internes &#233;troitement contr&#244;l&#233;s. Le d&#233;mon httpd ne cherchera
	d'ailleurs &#224; obtenir cette information que si la directive
	<code class="directive"><a href="./mod/mod_ident.html#identitycheck">IdentityCheck</a></code> est positionn&#233;e
	&#224; <code>On</code>.</dd>

        <dt><code>frank</code> (<code>%u</code>)</dt>

        <dd>Il s'agit de l'identifiant utilisateur de la personne qui a
	demand&#233; le document, issu d'une authentification HTTP.
	Ce m&#234;me identifiant est en g&#233;n&#233;ral fourni aux scripts CGI par
	l'interm&#233;diaire de la valeur de la variable d'environnement
	<code>REMOTE_USER</code>. Si le statut de la requ&#234;te (voir plus loin)
	est 401, cette identifiant n'est pas fiable car l'utilisateur n'est
	pas encore authentifi&#233;. Si le document n'est pas prot&#233;g&#233; par
	mot de passe, cette partie d'information sera repr&#233;sent&#233;e par
	"<code>-</code>", comme la partie pr&#233;c&#233;dente.</dd>

        <dt><code>[10/Oct/2000:13:55:36 -0700]</code>
        (<code>%t</code>)</dt>

        <dd>
          L'heure &#224; laquelle la requ&#234;te a &#233;t&#233; re&#231;ue.
          Le format est le suivant :

          <p class="indent">
            <code>[jour/mois/ann&#233;e:heure:minutes:secondes zone]<br />
             jour = 2*chiffre<br />
             mois = 3*lettre<br />
             ann&#233;e = 4*chiffre<br />
             heure = 2*chiffre<br />
             minutes = 2*chiffre<br />
             secondes = 2*chiffre<br />
             zone = (`+' | `-') 4*chiffre</code>
          </p>Il est possible de modifier le format d'affichage de l'heure
	  en sp&#233;cifiant <code>%{format}t</code> dans la cha&#238;ne de format du
	  journal, o&#249; <code>format</code> est une cha&#238;ne de format de m&#234;me
	  forme que celle de la fonction <code>strftime(3)</code> de la
	  biblioth&#232;que C standard.
        </dd>

        <dt><code>"GET /apache_pb.gif HTTP/1.0"</code>
        (<code>\"%r\"</code>)</dt>

        <dd>La ligne de la requ&#234;te du client est plac&#233;e entre guillemets.
	Elle contient de nombreuses informations utiles. Tout d'abord, la
	m&#233;thode utilis&#233;e par le client est <code>GET</code>. Ensuite, le
	client a demand&#233; la ressource <code>/apache_pb.gif</code>, et enfin,
	le client a utilis&#233; le protocole <code>HTTP/1.0</code>. Il est &#233;galement
	possible d'enregistrer s&#233;par&#233;ment une ou plusieurs parties de la
	requ&#234;te. Par exemple, la cha&#238;ne de format "<code>%m %U %q %H</code>"
	va enregistrer la m&#233;thode, le chemin, la cha&#238;ne de la requ&#234;te et le
	protocole, ce qui donnera le m&#234;me r&#233;sultat que
	"<code>%r</code>".</dd>

        <dt><code>200</code> (<code>%&gt;s</code>)</dt>

        <dd>C'est le code de statut que le serveur retourne au client. Cette
	information est tr&#232;s importante car elle indique si la requ&#234;te a fait
	l'objet d'une r&#233;ponse positive (codes commen&#231;ant par 2), une
	redirection (codes commen&#231;ant par 3), une erreur due au client (codes
	commen&#231;ant par 4), ou une erreur due au serveur (codes commen&#231;ant
	par 5). Vous trouverez la liste compl&#232;te des codes de statut possibles
	dans la <a href="http://www.w3.org/Protocols/rfc2616/  rfc2616.txt">specification HTTP</a> (RFC2616 section 10).</dd>

        <dt><code>2326</code> (<code>%b</code>)</dt>

        <dd>La derni&#232;re partie indique la taille de l'objet retourn&#233; au client,
	en-t&#234;tes non compris. Si aucun contenu n'a &#233;t&#233; retourn&#233; au client, cette
	partie contiendra "<code>-</code>". Pour indiquer l'absence de contenu
	par "<code>0</code>", utilisez <code>%B</code> au lieu de
	<code>%b</code>.</dd>
      </dl>
    

    <h3><a name="combined" id="combined">Combined Log Format (Format de journalisation combin&#233;)</a></h3>
      

      <p>Une autre cha&#238;ne de format couramment utilis&#233;e est le
      "Combined Log Format" (Format de journalisation combin&#233;). Il s'utilise
      comme suit :</p>

      <div class="example"><p><code>
        LogFormat "%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\"
        \"%{User-agent}i\"" combined<br />
         CustomLog log/access_log combined
      </code></p></div>

      <p>Ce format est identique au Common Log Format, avec deux champs
      suppl&#233;mentaires. Chacun de ces deux champs utilise la directive
      commen&#231;ant par le caract&#232;re "%" <code>%{<em>header</em>}i</code>,
      o&#249; <em>header</em> peut &#234;tre n'importe quel en-t&#234;te de requ&#234;te HTTP.
      Avec ce format, le journal des acc&#232;s se pr&#233;sentera comme suit :</p>

      <div class="example"><p><code>
        127.0.0.1 - frank [10/Oct/2000:13:55:36 -0700] "GET
        /apache_pb.gif HTTP/1.0" 200 2326
        "http://www.example.com/start.html" "Mozilla/4.08 [en]
        (Win98; I ;Nav)"
      </code></p></div>

      <p>Les champs suppl&#233;mentaires sont :</p>

      <dl>
        <dt><code>"http://www.example.com/start.html"</code>
        (<code>\"%{Referer}i\"</code>)</dt>

        <dd>L'en-t&#234;te "Referer" (sic) de la requ&#234;te HTTP. Il indique le site
	depuis lequel le client pr&#233;tend avoir lanc&#233; sa requ&#234;te. (Ce doit &#234;tre
	la page qui contient un lien vers <code>/apache_pb.gif</code> ou
	inclut ce dernier fichier).</dd>

        <dt><code>"Mozilla/4.08 [en] (Win98; I ;Nav)"</code>
        (<code>\"%{User-agent}i\"</code>)</dt>

        <dd>L'en-t&#234;te User-Agent de la requ&#234;te HTTP. C'est une information
	d'identification que le navigateur du client envoie &#224; propos
	de lui-m&#234;me.</dd>
      </dl>
    

    <h3><a name="multiple" id="multiple">Journaux d'acc&#232;s multiples</a></h3>
      

      <p>Plusieurs journaux d'acc&#232;s peuvent &#234;tre cr&#233;&#233;s en sp&#233;cifiant tout
      simplement plusieurs directives
      <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code> dans le
      fichier de configuration. Par exemple, les directives suivantes vont
      cr&#233;er trois journaux d'acc&#232;s. Le premier contiendra les informations
      de base CLF, le second les informations du Referer, et le troisi&#232;me
      les informations sur le navigateur. Les deux derni&#232;res directives
      <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code> montrent
      comment simuler les effets des directives <code>ReferLog</code> et
      <code>AgentLog</code>.</p>

      <div class="example"><p><code>
        LogFormat "%h %l %u %t \"%r\" %&gt;s %b" common<br />
        CustomLog logs/access_log common<br />
        CustomLog logs/referer_log "%{Referer}i -&gt; %U"<br />
        CustomLog logs/agent_log "%{User-agent}i"
      </code></p></div>

      <p>Cet exemple montre aussi qu'il n'est pas obligatoire d'associer
      une cha&#238;ne de format &#224; un alias au moyen de la directive
      <code class="directive"><a href="./mod/mod_log_config.html#logformat">LogFormat</a></code>. Elle peut
      &#234;tre d&#233;finie directement dans la ligne de la directive
      <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code>.</p>
    

    <h3><a name="conditional" id="conditional">Journalisation conditionnelle</a></h3>
      

      <p>Il est parfois souhaitable d'exclure certaines entr&#233;es des journaux
      d'acc&#232;s en fonction des caract&#233;ristiques de la requ&#234;te du client. On
      peut facilement y parvenir &#224; l'aide des
      <a href="env.html">variables d'environnement</a>. Tout d'abord, une
      variable d'environnement doit &#234;tre d&#233;finie pour indiquer que la
      requ&#234;te remplit certaines conditions. Pour ceci, on utilise en g&#233;n&#233;ral
      la directive <code class="directive"><a href="./mod/mod_setenvif.html#setenvif">SetEnvIf</a></code>,
      puis la clause <code>env=</code> de la directive
      <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code> pour inclure
      ou exclure les requ&#234;tes pour lesquelles
      la variable d'environnement est d&#233;finie.
      Quelques exemples :</p>

      <div class="example"><p><code>
        # Marque les requ&#234;tes en provenance de l'interface loop-back<br />
        SetEnvIf Remote_Addr "127\.0\.0\.1" dontlog<br />
        # Marque les requ&#234;tes pour le fichier robots.txt<br />
        SetEnvIf Request_URI "^/robots\.txt$" dontlog<br />
        # Journalise toutes les autres requ&#234;tes<br />
        CustomLog logs/access_log common env=!dontlog
      </code></p></div>

      <p>Autre exemple, imaginons l'enregistrement des requ&#234;tes en provenance
      d'utilisateurs de langue anglaise dans un journal, et celles des autres
      utilisateurs dans un autre journal.</p>

      <div class="example"><p><code>
        SetEnvIf Accept-Language "en" english<br />
        CustomLog logs/english_log common env=english<br />
        CustomLog logs/non_english_log common env=!english
      </code></p></div>

      <p>Bien que nous venions de montrer que la journalisation conditionnelle
      est souple et tr&#232;s puissante, cette m&#233;thode de contr&#244;le du contenu des
      journaux n'est pas la seule. Les fichiers journaux sont plus utiles
      quand ils contiennent un enregistrement complet de l'activit&#233; du serveur,
      et il est souvent plus ais&#233; de simplement traiter a posteriori les fichiers
      journaux pour supprimer les requ&#234;tes que vous ne voulez pas y voir
      appara&#238;tre.</p>
    
  </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="rotation" id="rotation">Rotation des journaux</a></h2>
    

    <p>M&#234;me dans le cas d'un serveur mod&#233;r&#233;ment sollicit&#233;, la quantit&#233;
    d'informations stock&#233;es dans les fichiers journaux est tr&#232;s importante.
    Le fichier journal des acc&#232;s grossit en g&#233;n&#233;ral d'1 Mo ou plus toutes
    les 10000 requ&#234;tes. Il est par cons&#233;quent n&#233;cessaire d'effectuer
    p&#233;riodiquement la rotation des journaux en d&#233;pla&#231;ant ou supprimant les
    fichiers correspondants. On ne peut pas le faire pendant que le serveur
    est en cours d'ex&#233;cution, car Apache va continuer &#224; &#233;crire dans l'ancien
    fichier journal aussi longtemps qu'il le maintiendra ouvert.
    C'est pourquoi le serveur doit &#234;tre
    <a href="stopping.html">red&#233;marr&#233;</a> apr&#232;s le d&#233;placement ou la
    suppression des fichiers journaux de fa&#231;on &#224; ce qu'il en ouvre
    de nouveaux.</p>

    <p>Avec un red&#233;marrage <em>graceful</em>, on peut faire en sorte que le
    serveur ouvre de nouveaux fichiers journaux sans perdre de connexions
    existantes ou en cours avec les clients. Cependant, pour que ceci soit
    possible, le serveur doit continuer &#224; &#233;crire dans les anciens fichiers
    journaux pendant qu'il termine le traitement des requ&#234;tes en cours.
    Il est donc n&#233;cessaire d'attendre un certain temps apr&#232;s le r&#233;d&#233;marrage
    avant d'effectuer tout traitement sur les fichiers journaux. Voici un
    sc&#233;nario typique dans lequel on effectue une simple rotation des
    journaux en compressant les anciens fichiers correspondants afin
    de gagner de l'espace disque :</p>

    <div class="example"><p><code>
      mv access_log access_log.old<br />
      mv error_log error_log.old<br />
      apachectl graceful<br />
      sleep 600<br />
      gzip access_log.old error_log.old
    </code></p></div>

    <p>La section suivante pr&#233;sente une autre m&#233;thode de rotation des journaux
    qui consiste &#224; utiliser les
    <a href="#piped">journaux redirig&#233;s</a>.</p>
  </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="piped" id="piped">Journaux redirig&#233;s</a></h2>
    

    <p>Nous avons vu que le d&#233;mon httpd &#233;crivait les informations de
    journalisation des erreurs et des acc&#232;s dans un fichier journal ;
    il peut &#233;galement
    rediriger ces informations vers un autre processus par l'interm&#233;diaire d'un
    tube de communication (pipe). Cette fonctionnalit&#233; am&#233;liore
    consid&#233;rablement la souplesse de la journalisation, sans ajouter de code
    au serveur principal. Pour rediriger les informations de journalisation
    vers un tube de communication, remplacez simplement le nom de fichier
    journal par
    le caract&#232;re pipe "<code>|</code>", suivi du nom de l'ex&#233;cutable qui va
    recueillir les entr&#233;es de journal sur son entr&#233;e standard. Apache va
    lancer le processus de redirection des journaux au moment du d&#233;marrage du
    serveur, et le relancera s'il cesse de fonctionner
    pendant l'ex&#233;cution du serveur.
    (Nous d&#233;nommons cette technique "journalisation
    redirig&#233;e fiable" gr&#226;ce &#224; cette derni&#232;re fonctionnalit&#233;.)</p>

    <p>Les processus de journalisation redirig&#233;e sont lanc&#233;s par le processus
    httpd parent, et h&#233;ritent de l'UID de ce dernier. Cela signifie que les
    programmes de journalisation dirig&#233;e s'ex&#233;cutent g&#233;n&#233;ralement en tant que
    root. Il est donc tr&#232;s important que ces programmes soient simples et
    s&#233;curis&#233;s.</p>

    <p>Un des grands avantages de la journalisation redirig&#233;e est la possibilit&#233;
    d'effectuer la rotation des journaux sans avoir &#224; red&#233;marrer le serveur. Pour
    accomplir cette t&#226;che, le serveur HTTP Apache fournit un programme simple
    appel&#233; <code class="program"><a href="./programs/rotatelogs.html">rotatelogs</a></code>. Par exemple, pour une rotation des
    journaux toutes les 24 heures, ajoutez ces lignes :</p>

    <div class="example"><p><code>
      CustomLog "|/usr/local/apache/bin/rotatelogs
      /var/log/access_log 86400" common
    </code></p></div>

    <p>Notez que l'ensemble de la commande qui sera appel&#233;e par le tube de
    communication a &#233;t&#233; plac&#233;e entre guillemets. Cet exemple
    concerne le journal des acc&#232;s, mais la m&#234;me technique peut &#234;tre utilis&#233;e
    pour le journal des erreurs.</p>

    <p>Comme la journalisation conditionnelle, la journalisation redirig&#233;e est
    un outil tr&#232;s puissant, mais si elle existe, il est pr&#233;f&#233;rable d'utiliser
    une solution plus simple comme le traitement a posteriori hors ligne.</p>
  

  <p>Par d&#233;faut, le processus de redirection du journal est
  lanc&#233; en invoquant un shell(en g&#233;n&#233;ral avec
  <code>/bin/sh -c</code>). Selon
    les sp&#233;cificit&#233;s du shell, l'invocation via un shell
    peut g&#233;n&#233;rer un processus shell
    suppl&#233;mentaire pour toute la dur&#233;e du programme de redirection du
    journal, et induire des probl&#232;mes de gestion de signaux au cours du
    red&#233;marrage.</p>

    <p>Pour lancer le programme sans invoquer un shell, utilisez
    "<code>||</code>" au lieu de "<code>|</code>" :</p>

    <div class="example"><p><code>
      # Invocation de "rotatelogs" sans utiliser de shell<br />
      CustomLog "||/usr/local/apache/bin/rotatelogs
      /var/log/access_log 86400" common
    </code></p></div>

    <div class="note"><h3>Note &#224; propos de la plateforme Windows</h3>
    <p>Notez que sous Windows, la m&#233;moire allou&#233;e au bureau (desktop
    heap) peut devenir insuffisante si vous utilisez de nombreux
    processus vers lesquels sont redirig&#233;s des journaux via un pipe, et
    ceci particuli&#232;rement si httpd s'ex&#233;cute en tant que service. La
    quantit&#233; de m&#233;moire du bureau allou&#233;e &#224; chaque service est sp&#233;cifi&#233;e
    dans le troisi&#232;me argument du param&#232;tre <code>SharedSection</code>
    de la cl&#233; de registre
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager\SubSystems\Windows.
    <strong>Modifiez cette valeur avec prudence</strong> ; les
    pr&#233;cautions d'usage s'imposent lorsqu'on modifie la base de registre,
    mais vous pouvez aussi saturer la m&#233;moire du bureau si vous
    sp&#233;cifiez une valeur trop &#233;lev&#233;e.</p>
    </div>
   </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="virtualhost" id="virtualhost">H&#244;tes virtuels</a></h2>
    

    <p>Lorsqu'un serveur poss&#232;de plusieurs <a href="vhosts/">h&#244;tes virtuels</a>, il existe de nombreuses solutions pour g&#233;rer
    les fichiers journaux. Par exemple, on peut utiliser les journaux comme
    s'il s'agissait d'un serveur avec un seul h&#244;te. Il suffit pour cela de
    placer les directives de journalisation en dehors des sections
    <code class="directive"><a href="./mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> au niveau
    du serveur principal, ce qui a pour effet de journaliser toutes les
    requ&#234;tes dans le m&#234;me journal des acc&#232;s et des erreurs. Cette technique
    est cependant inappropri&#233;e pour recueillir des statistiques sur chaque
    h&#244;te virtuel individuellement.</p>

    <p>Si des directives <code class="directive"><a href="./mod/mod_log_config.html#customlog">CustomLog</a></code> ou
    <code class="directive"><a href="./mod/core.html#errorlog">ErrorLog</a></code> sont plac&#233;es dans une section
    <code class="directive"><a href="./mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>, toutes les
    requ&#234;tes ou erreurs pour cet h&#244;te virtuel ne seront enregistr&#233;es que dans
    le fichier sp&#233;cifi&#233;. Tout h&#244;te virtuel qui ne poss&#232;de pas de directives de
    journalisation verra ses requ&#234;tes enregistr&#233;es dans le journal du serveur
    principal. Cette technique est appropri&#233;e pour un petit nombre d'h&#244;tes
    virtuels, mais si ce nombre est important, elle peut devenir compliqu&#233;e &#224;
    g&#233;rer. En outre, des probl&#232;mes de <a href="vhosts/fd-limits.html">nombre de descripteurs
    de fichiers insuffisant</a> peuvent rapidement appara&#238;tre.</p>

    <p>Il existe un tr&#232;s bon compromis pour le journal des acc&#232;s. En int&#233;grant
    les informations &#224; propos de l'h&#244;te virtuel &#224; la cha&#238;ne de format du
    journal, il est possible de journaliser tous les h&#244;tes dans le m&#234;me
    journal, puis de s&#233;parer ult&#233;rieurement le journal en plusieurs journaux
    individuels. Consid&#233;rons par exemple les directives suivantes :</p>

    <div class="example"><p><code>
      LogFormat "%v %l %u %t \"%r\" %&gt;s %b"
      comonvhost<br />
      CustomLog logs/access_log comonvhost
    </code></p></div>

    <p>Le champ <code>%v</code> sert &#224; enregistrer le nom de l'h&#244;te virtuel qui
    traite la requ&#234;te. Un programme tel que <a href="programs/other.html">split-logfile</a> peut ensuite &#234;tre utilis&#233;
    pour g&#233;n&#233;rer "&#224; froid" autant de journaux que d'h&#244;tes virtuels.</p>
  </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
<div class="section">
<h2><a name="other" id="other">Autres fichiers journaux</a></h2>
    

    <table class="related"><tr><th>Modules Apparent&#233;s</th><th>Directives Apparent&#233;es</th></tr><tr><td><ul><li><code class="module"><a href="./mod/mod_logio.html">mod_logio</a></code></li><li><code class="module"><a href="./mod/mod_log_forensic.html">mod_log_forensic</a></code></li><li><code class="module"><a href="./mod/mod_cgi.html">mod_cgi</a></code></li><li><code class="module"><a href="./mod/mod_rewrite.html">mod_rewrite</a></code></li><li><code class="module"><a href="./mod/mod_log_config.html">mod_log_config</a></code></li></ul></td><td><ul><li><code class="directive"><a href="./mod/mod_log_config.html#logformat">LogFormat</a></code></li><li><code class="directive"><a href="./mod/mod_log_config.html#bufferedlogs">BufferedLogs</a></code></li><li><code class="directive"><a href="./mod/mod_log_forensic.html#forensiclog">ForensicLog</a></code></li><li><code class="directive"><a href="./mod/mpm_common.html#pidfile">PidFile</a></code></li><li><code class="directive"><a href="./mod/mod_rewrite.html#rewritelog">RewriteLog</a></code></li><li><code class="directive"><a href="./mod/mod_rewrite.html#rewriteloglevel">RewriteLogLevel</a></code></li><li><code class="directive"><a href="./mod/mod_cgi.html#scriptlog">ScriptLog</a></code></li><li><code class="directive"><a href="./mod/mod_cgi.html#scriptlogbuffer">ScriptLogBuffer</a></code></li><li><code class="directive"><a href="./mod/mod_cgi.html#scriptloglength">ScriptLogLength</a></code></li></ul></td></tr></table>

    <h3>Enregistrement du nombre r&#233;el d'octets envoy&#233;s et re&#231;us</h3>
      

      <p>Le module <code class="module"><a href="./mod/mod_logio.html">mod_logio</a></code> fournit deux champs
      <code class="directive"><a href="./mod/mod_log_config.html#logformat">LogFormat</a></code> suppl&#233;mentaires
      (%I et %O) qui permettent d'enregistrer le nombre r&#233;el d'octets re&#231;us et
      envoy&#233;s sur le r&#233;seau.</p>
    

    <h3>Journalisation de style investigation judiciaire (forensic logging)</h3>
      

      <p>Le module <code class="module"><a href="./mod/mod_log_forensic.html">mod_log_forensic</a></code> permet la journalisation
      &#224; des fins d'investigation judiciaire des requ&#234;tes des clients. La
      journalisation est effectu&#233;e avant et apr&#232;s le traitement de la requ&#234;te,
      qui fait donc l'objet de deux entr&#233;es dans le journal. Le g&#233;n&#233;rateur de
      journaux d'investigation est tr&#232;s strict et ne permet aucune
      personnalisation. C'est un inestimable outil de d&#233;bogage et de s&#233;curit&#233;.</p>
    

    <h3><a name="pidfile" id="pidfile">Fichier PID</a></h3>
      

      <p>Au d&#233;marrage, le d&#233;mon httpd Apache enregistre l'identifiant du
      processus httpd parent dans le fichier <code>logs/httpd.pid</code>.
      Le nom de ce fichier peut &#234;tre modifi&#233; &#224; l'aide de la directive
      <code class="directive"><a href="./mod/mpm_common.html#pidfile">PidFile</a></code>. Cet identifiant
      permet &#224; l'administrateur de red&#233;marrer et arr&#234;ter le d&#233;mon en
      envoyant des signaux au processus parent ; sous Windows, vous devez
      utiliser l'option de ligne de commande -k. Pour plus de d&#233;tails,
      consulter la page <a href="stopping.html">Arr&#234;t et red&#233;marrage</a>.</p>
    

    <h3><a name="scriptlog" id="scriptlog">Journal des scripts</a></h3>
      

      <p>Afin de faciliter le d&#233;bogage, la directive
      <code class="directive"><a href="./mod/mod_cgi.html#scriptlog">ScriptLog</a></code> vous permet
      d'enregistrer les entr&#233;es et sorties des scripts CGI. Elle ne doit &#234;tre
      utilis&#233;e que pendant la phase de test, et en aucun cas sur un
      serveur en production. Vous trouverez plus d'informations dans la
      documentation du module <a href="mod/mod_cgi.html">mod_cgi</a>.</p>
    

    <h3><a name="rewritelog" id="rewritelog">Journal de r&#233;&#233;criture</a></h3>
      

      <p>Lorsqu'on utilise les fonctionnalit&#233;s puissantes et complexes du
      module <a href="mod/mod_rewrite.html">mod_rewrite</a>, il est presque
      toujours n&#233;cessaire d'utiliser la directive
      <code class="directive"><a href="./mod/mod_rewrite.html#rewritelog">RewriteLog</a></code> afin de
      faciliter le d&#233;bogage. Ce fichier journal fournit une analyse d&#233;taill&#233;e
      de la transformation des requ&#234;tes par le moteur de r&#233;&#233;criture. Le niveau
      de d&#233;tail est contr&#244;l&#233; par la directive
      <code class="directive"><a href="./mod/mod_rewrite.html#rewriteloglevel">RewriteLogLevel</a></code>.</p>
    
  </div></div>
<div class="bottomlang">
<p><span>Langues Disponibles: </span><a href="./en/logs.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
<a href="./fr/logs.html" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
<a href="./ja/logs.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
<a href="./ko/logs.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
<a href="./tr/logs.html" hreflang="tr" rel="alternate" title="T&#252;rk&#231;e">&nbsp;tr&nbsp;</a></p>
</div><div class="top"><a href="#page-header"><img src="./images/up.gif" alt="top" /></a></div><div class="section"><h2><a id="comments_section" name="comments_section">Commentaires</a></h2><div class="warning"><strong>Notice:</strong><br />This is not a Q&amp;A section. Comments placed here should be pointed towards suggestions on improving the documentation or server, and may be removed again by our moderators if they are either implemented or considered invalid/off-topic. Questions on how to manage the Apache HTTP Server should be directed at either our IRC channel, #httpd, on Libera.chat, or sent to our <a href="http://httpd.apache.org/lists.html">mailing lists</a>.</div>
<script type="text/javascript"><!--//--><![CDATA[//><!--
var comments_shortname = 'httpd';
var comments_identifier = 'http://httpd.apache.org/docs/2.2/logs.html';
(function(w, d) {
    if (w.location.hostname.toLowerCase() == "httpd.apache.org") {
        d.write('<div id="comments_thread"><\/div>');
        var s = d.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = 'https://comments.apache.org/show_comments.lua?site=' + comments_shortname + '&page=' + comments_identifier;
        (d.getElementsByTagName('head')[0] || d.getElementsByTagName('body')[0]).appendChild(s);
    }
    else { 
        d.write('<div id="comments_thread">Comments are disabled for this page at the moment.<\/div>');
    }
})(window, document);
//--><!]]></script></div><div id="footer">
<p class="apache">Copyright 2018 The Apache Software Foundation.<br />Autoris&#233; sous <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
<p class="menu"><a href="./mod/">Modules</a> | <a href="./mod/directives.html">Directives</a> | <a href="http://wiki.apache.org/httpd/FAQ">FAQ</a> | <a href="./glossary.html">Glossaire</a> | <a href="./sitemap.html">Plan du site</a></p></div><script type="text/javascript"><!--//--><![CDATA[//><!--
if (typeof(prettyPrint) !== 'undefined') {
    prettyPrint();
}
//--><!]]></script>
</body></html>